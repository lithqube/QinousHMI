<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:atvise="http://www.atvise.com/" xmlns:cc="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:svg="http://www.w3.org/2000/svg" xmlns:svgmaker="http://www.svgmaker.com/svgns" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <title></title>
  <style>v\:*{behavior:url(#default#VML)}body{overflow:hidden}</style>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
 </head>
 <body>
  <v:group atv:coordfactor="100" atv:oe="2BD6F3BAD3C6P2OEI9MCM759A8C5D35F769AICH4D9M1C1MBPDLCT45CB68GEDG87" coordsize="96400,60000" id="webmivmlroot" style="height:600px;left:0;position:absolute;top:0;visibility:hidden;width:964px">
   <v:polyline fillcolor="#21246e" id="id_31" points="13500,15100 84400,35200 16600,14500 81500,18400 58900,35600 52300,29200 4200,49800 8700,8400 12400,13700 39400,51800 43300,6100 60900,23300 3000,5500 13500,15100 " strokecolor="#94fc17" stroked="true" strokeweight="3.75"/>
   <v:group coordorigin="-95750,0" coordsize="200000,50000" style="height:50000px;left:-95750px;top:0px;width:200000px">
    <v:group atv:origx="0" atv:origy="3000" atv:refpx="42.5" atv:refpy="50" coordsize="8500,3000" id="bttn_taskmenu" style="height:3000px;left:0;top:0;visibility:hidden;width:8500px">
     <v:shapetype id="1linear_0">
      <v:fill angle="225" colors="0 #ffffff, 1 #01c901" method="none" rotate="true" type="gradient"/>
     </v:shapetype>
     <v:group atv:insensitive="true" atv:origtransform="matrix(0.0664,0,0,0.0391,0,0)" atv:refpx="0" atv:refpy="3000" coordorigin="0,0" coordsize="0,0" id="bttn_taskmenu_bttn_taskmenu" style="height:0px;left:0px;top:0px;width:0px"/>
     <v:oval fillcolor="#c1b960" id="id_25" strokecolor="#04de9f" stroked="true" strokeweight="1.5" style="height:22200px;left:24400px;top:27800px;width:22200px"/>
     <v:roundrect arcsize="0.155" atv:refpx="4257" atv:refpy="4462" filled="false" id="bttn_taskmenu_brdr_button" strokecolor="#647A8F" stroked="true" strokeweight="0.75" style="height:2800px;left:100px;top:3100px;width:8300px"/>
     <v:line atv:refpx="4250" atv:refpy="1600" from="-95750 4600" id="bttn_taskmenu_txt_taskname" to="104250 4700">
      <v:path textpathok="true"/>
      <v:fill color="#647a8f" on="true"/>
      <v:stroke on="false"/>
      <v:textpath on="true" string="" style="font-family:'Open Sans';font-size:12px;v-text-align:center"/>
     </v:line>
     <v:line fillcolor="#c789f8" from="51800,30200" id="id_26" strokecolor="#0ba59c" stroked="true" strokeweight="0.75" to="54000,35200">
      <v:stroke joinstyle="miter"/>
     </v:line>
    </v:group>
   </v:group>
   <v:oval fillcolor="#38715b" id="id_35" strokecolor="#ac46fe" stroked="true" strokeweight="1.5" style="height:22400px;left:74700px;top:36600px;width:22400px"/>
   <v:group coordorigin="0,0" coordsize="204621,90500" style="height:90500px;left:0px;top:0px;width:204621px">
    <v:group atv:origx="1000" atv:origy="9000" atv:refpx="139.991" atv:refpy="242.263" coordsize="25000,51000" id="nav_omponent" style="height:51000px;left:0;top:0;width:25000px">
     <v:line fillcolor="#a925f6" from="77600,18400" id="id_37" strokecolor="#168e2f" stroked="true" strokeweight="0.75" to="39200,59400">
      <v:stroke joinstyle="miter"/>
     </v:line>
     <v:group atv:origtransform="matrix(0.8333,0,0,0.75,0,0)" atv:refpx="13500" atv:refpy="34500" coordorigin="1000,9000" coordsize="56081,51000" id="nav_omponent_tree" style="height:51000px;left:1000px;top:9000px;width:56081px">
      <v:rect atv:refpx="13500" atv:refpy="34500" fillcolor="#FFFFFF" id="nav_omponent_id_0" stroked="false" strokeweight="0" style="height:51000px;left:1000px;top:9000px;width:24999px"/>
      <v:rect fillcolor="#372023" id="id_4" strokecolor="#76d5af" stroked="true" strokeweight="1.19" style="height:11100px;left:55248px;top:27750px;width:1833px"/>
     </v:group>
     <v:group coordorigin="0,0" coordsize="204621,90500" style="height:90500px;left:0px;top:0px;width:204621px">
      <v:group atv:origx="102" atv:origy="0" atv:refpx="151.023" atv:refpy="15" coordsize="25000,4000" id="nav_omponent_id_6" style="height:4000px;left:0;top:0;width:25000px">
       <v:rect atv:refpx="15102" atv:refpy="11000" fillcolor="#EEF1F2" id="nav_omponent_id_6_selectedIndicator" stroked="false" strokeweight="0" style="height:4000px;left:4102px;top:9000px;width:22000px"/>
       <v:line atv:bindbr="0,1" atv:bindtl="0,1" atv:refpx="2990" atv:refpy="2414" from="4621 11217" id="nav_omponent_id_6_id_0" to="204621 11317">
        <v:skew matrix="0.9836,0,0,1" on="true" origin="-0.5231,-112.66667"/>
        <v:path textpathok="true"/>
        <v:fill color="#00ABE5" on="true"/>
        <v:stroke on="false"/>
        <v:textpath on="true" string="$title$" style="font-family:'Varela Round';font-size:16px;v-text-align:left"/>
       </v:line>
       <v:polyline atv:matrix="1,0,0,1,11.023,90" fillcolor="#c8be13" id="id_16" points="39802,48100 95202,51000 72702,34500 27402,65400 2002,43500 34402,33900 14202,51100 19702,61700 53202,47200 41002,46300 2702,26200 28502,56400 17702,12700 33802,37800 " strokecolor="#44302e" stroked="true" strokeweight="3.75">
        <v:stroke joinstyle="miter"/>
       </v:polyline>
       <v:group atv:origtransform="matrix(1,0,0,1,0.6337,-10.2179)" atv:refpx="1102" atv:refpy="9000" coordorigin="0,0" coordsize="0,0" id="nav_omponent_id_6_id_10" style="height:0px;left:0px;top:0px;width:0px"/>
       <v:line fillcolor="#619250" from="11502,28100" id="id_22" strokecolor="#b0a480" stroked="true" strokeweight="3" to="47402,49400">
        <v:stroke joinstyle="miter"/>
       </v:line>
       <v:polyline atv:bindbr="1,1" atv:bindtl="1,1" atv:matrix="1,0,0,1,11.023,90" atv:refpx="2902" atv:refpy="11300" fillcolor="#00ABE5" id="nav_omponent_id_6_collapsedIndicator" points="2452,10550 2452,12050 3352,11300 2452,10550 " stroked="false" strokeweight="0">
        <v:stroke joinstyle="miter"/>
       </v:polyline>
       <v:polyline atv:bindbr="1,1" atv:bindtl="1,1" atv:matrix="1,0,0,1,11.023,90" atv:refpx="2853" atv:refpy="11350" fillcolor="#00ABE5" id="nav_omponent_id_6_expandedIndicator" points="3603,10900 2103,10900 2853,11800 3603,10900 " stroked="false" strokeweight="0">
        <v:stroke joinstyle="miter"/>
       </v:polyline>
       <v:oval fillcolor="#1d76e6" id="id_27" strokecolor="#21c2ee" stroked="true" strokeweight="0.75" style="height:59600px;left:4802px;top:30900px;width:59600px"/>
       <v:rect atv:refpx="3102" atv:refpy="11000" fillcolor="#0000ff" id="nav_omponent_id_6_expandClickarea" stroked="false" strokeweight="0" style="height:4000px;left:1102px;top:9000px;width:4000px">
        <v:fill opacity="0"/>
       </v:rect>
       <v:rect fillcolor="#b2746b" id="id_29" strokecolor="#110606" stroked="true" strokeweight="0.75" style="height:800px;left:10402px;top:46000px;width:53200px"/>
      </v:group>
     </v:group>
     <!--</svg>-->
</v:group>
   </v:group>
   <v:polyline fillcolor="#e400ac" id="id_17" points="83100,43400 41700,7600 46600,12100 88900,44700 56600,49500 34500,18000 69700,3000 80900,15800 85600,25900 83100,43400 " strokecolor="#1ae3c1" stroked="true" strokeweight="3"/>
   <v:group atv:origtransform="matrix(0.8688,0,0,0.85,0,0)" coordorigin="0,0" coordsize="261864,59830" style="height:59830px;left:0px;top:0px;width:261864px">
    <v:group atv:origx="30964" atv:origy="10588" atv:refpx="617.5" atv:refpy="345" coordsize="80000,60000" id="new_iframe" style="height:60000px;left:0;top:0;width:80000px">
     <v:rect atv:refpx="61654" atv:refpy="34500" filled="false" id="new_iframe_stroke" strokecolor="#000000" stroked="true" strokeweight="1.29" style="height:50660px;left:27075px;top:9170px;width:69156px"/>
     <v:line fillcolor="#659621" from="98491,46740" id="id_30" strokecolor="#9d0893" stroked="true" strokeweight="1.93" to="65650,18095">
      <v:stroke joinstyle="miter"/>
     </v:line>
     <v:oval fillcolor="#b6b8a2" id="id_24" strokecolor="#bfed8c" stroked="true" strokeweight="3.22" style="height:31450px;left:58005px;top:14865px;width:32146px"/>
     <v:group atv:refpx="26902" atv:refpy="9000" coordorigin="0,0" coordsize="0,0" id="new_iframe_iframegroup" style="height:0px;left:0px;top:0px;width:0px"/>
     <v:line atv:refpx="40000" atv:refpy="30000" from="61864 40938" id="new_iframe_label" to="261864 41038">
      <v:skew matrix="0.8688,0,0,0.85" on="true" origin="-0.80932,-409.882"/>
      <v:path textpathok="true"/>
      <v:fill color="#000000" on="true"/>
      <v:stroke on="false"/>
      <v:textpath on="true" string="IFRAME" style="font-family:'Verdana';font-size:48px;v-text-align:left"/>
     </v:line>
     <v:oval fillcolor="#ee986f" id="id_32" strokecolor="#b57594" stroked="true" strokeweight="1.29" style="height:340px;left:21428px;top:45465px;width:66898px"/>
     <v:line atv:refpx="40000" atv:refpy="36961" from="48514 47899" id="new_iframe_label2" to="248514 47999">
      <v:skew matrix="0.8688,0,0,0.85" on="true" origin="-0.74257,-479.492"/>
      <v:path textpathok="true"/>
      <v:fill color="#000000" on="true"/>
      <v:stroke on="false"/>
      <v:textpath on="true" string="(display container)" style="font-family:'Verdana';font-size:48px;v-text-align:left"/>
     </v:line>
    </v:group>
   </v:group>
   <v:oval fillcolor="#44c9b9" id="id_34" strokecolor="#2eab5a" stroked="true" strokeweight="3" style="height:33400px;left:18100px;top:-6700px;width:33400px"/>
   <v:group atv:origtransform="matrix(1,0,0,1,-24,25)" atv:refpx="84075" atv:refpy="4550" coordorigin="12600,3050" coordsize="268950,70950" id="id_btn_Select" style="height:70950px;left:12600px;top:3050px;width:268950px">
    <v:roundrect arcsize="0.167" atv:refpx="83600" atv:refpy="4500" filled="false" id="id_5" strokecolor="#647a8f" stroked="true" strokeweight="0.75" style="height:3000px;left:80650px;top:3050px;width:6000px"/>
    <v:oval fillcolor="#c69d15" id="id_28" strokecolor="#ca177b" stroked="true" strokeweight="1.5" style="height:15200px;left:30300px;top:31900px;width:15200px"/>
    <v:oval fillcolor="#a01f60" id="id_11" strokecolor="#4b2223" stroked="true" strokeweight="0.75" style="height:30400px;left:34800px;top:43600px;width:30400px"/>
    <v:line atv:refpx="86300" atv:refpy="2000" from="81550 4550" id="id_7" to="281550 4650">
     <v:path textpathok="true"/>
     <v:fill color="#647a8f" on="true"/>
     <v:stroke on="false"/>
     <v:textpath on="true" string="LOAD" style="font-family:'Bryant Regular';font-size:12px;v-text-align:left"/>
    </v:line>
    <v:polyline atv:matrix="1,0,0,1,-24,25" fillcolor="#49fbe3" id="id_3" points="63600,56000 36900,9500 71900,8200 10200,10700 82400,17800 66200,59600 " strokecolor="#757e28" stroked="true" strokeweight="0.75">
     <v:stroke joinstyle="miter"/>
    </v:polyline>
   </v:group>
   <v:group atv:origtransform="matrix(1,0,0,1,-19.5,25.5)" atv:refpx="92625" atv:refpy="4550" coordorigin="18400,2300" coordsize="270650,49900" id="id_btn_Upload" style="height:49900px;left:18400px;top:2300px;width:270650px">
    <v:roundrect arcsize="0.167" atv:refpx="91550" atv:refpy="4550" filled="false" id="id_6" strokecolor="#647a8f" stroked="true" strokeweight="0.75" style="height:3000px;left:88550px;top:3050px;width:6000px"/>
    <v:oval fillcolor="#d29853" id="id_36" strokecolor="#e67d5b" stroked="true" strokeweight="2.25" style="height:10000px;left:23450px;top:35050px;width:10000px"/>
    <v:line atv:refpx="94200" atv:refpy="1950" from="89050 4550" id="id_8" to="289050 4650">
     <v:path textpathok="true"/>
     <v:fill color="#647a8f" on="true"/>
     <v:stroke on="false"/>
     <v:textpath on="true" string="UPLOAD" style="font-family:'Bryant Regular';font-size:12px;v-text-align:left"/>
    </v:line>
    <v:polyline atv:matrix="1,0,0,1,-19.5,25.5" fillcolor="#6aeb0a" id="id_23" points="53450,9050 31850,54750 63950,40450 24850,8650 42650,40850 54650,4850 59950,53350 57750,12250 55150,5550 93450,29250 79950,48850 25950,35950 16450,13950 53450,9050 " strokecolor="#a99bef" stroked="true" strokeweight="1.5"/>
   </v:group>
  </v:group>
  <div id="foreignObjects">
   <div atv:origtransform="matrix(0.8688,0,0,0.85,269.0152,89.9997)" id="new_iframe_iframediv" style="height:510px;left:269px;position:absolute;top:90px;width:695px">    <iframe allowTransparency="true" style="width:100%;height:100%" id="new_iframe_myframe" frameborder="0" scrolling="no">iframe</iframe>
   </div>
   <div atv:origtransform="matrix(0.8688,0,0,0.85,269.0152,89.9997)" id="new_iframe_zoomareadiv" style="height:510px;left:269px;position:absolute;top:90px;width:695px">    <div style="width:100%;height:100%;background-color:white;opacity:0;filter:alpha(opacity=0);" id="new_iframe_zoomarea" scrolling="no"></div>
   </div>
   <div atv:origtransform="matrix(0.8688,0,0,0.85,269.0152,89.9997)" id="new_iframe_zoomboxdiv" style="height:0px;left:269px;position:absolute;top:90px;width:0px">    <div style="width: 100%; height:100%;" id="new_iframe_zoombox"></div>
   </div>
   <div id="id_1" style="height:25px;left:0px;position:absolute;top:570px;width:120px">    <div style="width:100%;height:100%">     <form action="">      <input type="file" style="display:none" id="file_input"/>
     </form>
    </div>
   </div>
  </div>
  <script type="text/javascript" src="../../webmi.js"></script>
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <script type="text/javascript" src="/q/StdConstantsFunctions.js"></script>
  <script type="text/javascript">//<![CDATA[
webMI.proxy({"":[function(webMI,window,document,self){var $ = top.$;
var paramTree = [];
var paramSelection = [];
var selectedTask = '';


webMI.addOnload(function(f){
	paramTree = [];
	paramSelection = [];
	selectedTask = '';

	var parameterViewAllowed = webMI.hasRight(VIEW_PARAMETERS);

	if (parameterViewAllowed) {
		webMI.trigger.fire("RequestTaskList");	
		webMI.trigger.fire("RequestParameterTree");		
		webMI.display.openDisplay("00000006", webMI.query, "parameterTable");
	} else {
		alert("Hello! User do not have the proper rights to excute this functionality");
		webMI.display.openDisplay("00000002");
	
	}
});// END For

webMI.addEvent("id_btn_Select", ["mouseover","touchstart"], function(e){

	document.getElementById("id_btn_Select").setAttribute('style', "cursor: pointer;");		
});

webMI.addEvent("id_btn_Upload", ["mouseover","touchstart"], function(e){

	document.getElementById("id_btn_Upload").setAttribute('style', "cursor: pointer;");		
});


// - - - - - -  Upload process

webMI.addEvent("id_btn_Upload", "click", function(e) {
var id = "id_btn_Upload";
var value = true;
var input = document.getElementById("file_input");
var file = input.files[0];
var xmlhttp = new XMLHttpRequest();
xmlhttp.open("PUT" , "/" + input.files[0].name);
xmlhttp.setRequestHeader("Content-type", "application/octet-stream");
xmlhttp.send(file);
});

webMI.addEvent("id_btn_Select", "click", function(e) {
var id = "id_btn_Select";
var value = true;
return function(value) {
var input = document.getElementById("file_input");
if (input) {
input.click(); 
}
} (value);
});


// Task Menu Generation
webMI.trigger.connect("SetTaskList", function(e){

	var A = document.getElementById("bttn_taskmenu");
	var brdr_button = document.getElementById("bttn_taskmenu_brdr_button");
	//var txt_taskname = document.getElementById("bttn_taskmenu_txt_taskname");

	var Root = A.parentElement;
	var newA;
	
	var tsk_array = e.value; //["SAMVAC","QD_DSE","QM_HOMB","Q_SYS"];
//	console.log("Received task list "+tsk_array.length);

	for (var i = 0; i< tsk_array.length; i++)
	{
		// Move Factor
			var factorX = 20 + (100 * i);

		// Clone
			newA = A.cloneNode(true);
			newA.setAttribute("x",factorX);
			newA.id = "bttn_taskmenu"+i; 
			newA.setAttribute("visibility", "visible");
			Root.appendChild(newA);
		// Task name

			var txt_taskname = document.getElementById(newA.id).getElementsByTagName("text") ;

//			console.log("Creating button for "+tsk_array[i].task+", "+txt_taskname);
			txt_taskname[0].innerHTML = tsk_array[i].task;

			if (tsk_array[i].selected) {
				// todo highlight newA.setAttribute("visibility", "visible");
				selectedTask = tsk_array[i].task;	
			//	console.log("========== just set the selected task", selectedTask);						
			}
	
			newA.addEventListener("click", function(e) {
				selectTask(this.id);		
			});	

		//Highlight Menu			
			newA.addEventListener("mouseover", function(e) {
				document.getElementById(this.id).setAttribute('style', "cursor: pointer;");					
			});
	}// END For
	if (selectedTask == ''){
		selectedTask = tsk_array[0].task;
	}


}); 
// End task menu generation

function selectTask(setId){
	selectedTask = document.getElementById(setId).getElementsByTagName("text")[0].innerHTML;
	console.log("Task selected: "+setId+" Task Name: "+selectedTask);
	webMI.trigger.fire("SetConfigTask", selectedTask);
	// TODO: loop through all task buttons. select the one with setId as text, deselect the rest
}

webMI.trigger.connect("SetParameterTree", function(e){
	paramTree.length = 0;
	paramTree = e.value;
//	console.log("Received a complete parameter tree: "+paramTree);
// extract titles of all elements that have children, and pass to tree-navigation
	var paramSectionTree = getSections(paramTree);
	webMI.trigger.fire("SetParameterSectionTree", paramSectionTree);
});

webMI.trigger.connect("SetParamTreeSelection", function(e){
	paramSelection = e.value;
	webMI.display.openDisplay("00000006", webMI.query, "parameterTable");
});

webMI.trigger.connect("RequestParameterList", function(e){
//	console.log("Param list requested for "+paramSelection);
	webMI.trigger.fire("SetParameterList", getParameterList(paramSelection, paramTree));
});

function getParameterList(variables, nodeList, prefix){
	console.log("Extracting parameter list for selected ",selectedTask);
	if (prefix == undefined){
		prefix = '';
	}
	if (variables.length == 0) {
		return [];
	} else {
		for (var i=0; i<nodeList.length; i++){

			if (nodeList[i].variable === variables[variables.length-1]) {

				var new_prefix = variables.pop();

				if (nodeList[i].childs.length > 0) {
					var child_var = nodeList[i].childs[0].variable;
				
					if (child_var.slice(0, child_var.indexOf("[")) === nodeList[i].variable) {
						//console.log("That's an array group!");
						new_prefix = "";
					}
				}
				prefix = prefix + new_prefix;
				if (variables.length == 0) {
					console.log("============RETURNING PARAMLIST:", nodeList[i].dp_list, selectedTask, prefix);

					return [nodeList[i].dp_list, selectedTask, prefix];
				} else {
					return getParameterList(variables, nodeList[i].childs, prefix);
				}
			}			
		}
		return [];
	}
}

function getSections(nodeList){
	var sections = [];
	//console.log("Getting sections (just stripping out the dps)");
	for(var i=0; i<nodeList.length; i++){
		sections[i] = {title: nodeList[i].title, variable: nodeList[i].variable};
		//console.log("Stripped a seciotn out: "+sections[i].title);
		if (nodeList[i].childs !== undefined) {
			if (nodeList[i].childs.length > 0) {
				sections[i].childs = getSections(nodeList[i].childs);
			}
		}
	}
	return sections;
}


//Fonts
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"font family", "id":"id_7", "key":"FontFamily", "property":""});
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"font family", "id":"id_8", "key":"FontFamily", "property":""});
},{"bttn_taskmenu":["1",{}],"nav_omponent":["2",{}],"new_iframe":["4",{"frameName":{v:"parameterTable"}}]},{}],"1":[function(webMI,window,document,self){webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"font family", "id":"txt_taskname", "key":"FontFamily", "property":""});
},{},{"TaskName":""}],"2":[function(webMI,window,document,self){webMI.trigger.connect("SetParameterSectionTree", function(e){

	var proto = document.getElementById("tree").parentNode.id + "_" +"id_6";
	var paramTree = e.value;

	webMI.callExtension('SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Tree', {
		id: document.getElementById("tree").parentNode.id + "_" + "tree",
		prototypeItem: proto,
		indent: 10,
		source: paramTree,
		delegate: {
			bind: {
				// Bind the Valuebar
				/*"Server1/RES/Time_s": function(sourceItem, value) {
					console.error(value);
					webMI.gfx.setText(sourceItem.view.subview("id_6"), value);
				},*/
			},
	
			itemIsSelectable: function(sourceItem) {
				return true; //sourceItem.level > 0;
			},
	
			// Add a callback when items are selected
			itemSelected: function(sourceItem) {
				var variables = [];
				var item = sourceItem;
				var i = 0;
				while ((item) && (i< 5) && (typeof item !== 'undefined')){
//					console.log("look at item: "+item);
					variables.push(item.variable);
					item = item.parent;	
					i++;
				}
//				console.log("current selection is " + variables);
				webMI.trigger.fire("SetParamTreeSelection", variables);
				
			}
		}
	});

});

webMI.addOnload(function(e) {

//	webMI.trigger.fire("RequestParameterTree");

});
},{"id_6":["3",{}]},{}],"4":[function(webMI,window,document,self){var isNavigationFrame = webMI.query["isNavigationFrame"] == "true";
var url = webMI.query["url"];
var display = webMI.query["display"];
var targetUrl = url;
targetUrl = (targetUrl != undefined) ? targetUrl : webMI.display.createURL(display,{"base":webMI.query.base});
var frameName = webMI.query["frameName"];
var defaultFrameName = "";
var firstCCDExceeded = true;
var myFrame = document.getElementById("myframe");
var myLoadingscreen = null;
var myExcldFrame = null;
var urlPrefix = "";
var urlPostfix = "";
var currentActiveFrame = myFrame;
var consistencyHandler = webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Consistency Handler");
var tabHandler = webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Tab Handler");

var mousedownpos1 = null;
var mousedownpos2 = null;
var mousedownpospan = null;
var olddisplaystyle = null;

var zoomAreaDiv = document.getElementById("zoomareadiv");
var zoomBoxDiv = document.getElementById("zoomboxdiv");
var zoomBoxParent = null;

var myIframe = document.getElementById(frameName);
var myIframeDiv = document.getElementById("iframediv");

var iframegroup = document.getElementById("iframegroup");

var zoomArea = document.getElementById("zoomarea");

var preloadGroup = document.getElementById("preload_group");

var preloaded = false;
var excludePreloaded = [];
var includePreloaded = [];
var preloadedFrames = {};
var runOnce = true;
var resumeCallbackObjects = [];

if (webMI.display.isVML())
	myFrame.style.position = "absolute";

function isInArray(arr,elem,replace){
	for (var iA=0;iA<arr.length;iA++){
		if ((typeof elem == "string") && (elem == arr[iA] || elem == urlPrefix+arr[iA]+urlPostfix)) {
			if (replace && elem != replace){ arr[iA] = replace;}
			return true;
		} else if ((typeof elem == "object") && arr[iA] == elem){
			return true;
		}
	}
	return false;
};
function createLoadingScreen(loadingscreen){
	myLoadingscreen = webMI.dom.createElement("http://www.w3.org/1999/xhtml", "div");
	myLoadingscreen.style.fontFamily = "Arial";
	myLoadingscreen.style.overflow = "hidden";
	myLoadingscreen.style.position = "absolute";
	myLoadingscreen.style.left = "0";
	myLoadingscreen.style.top = "0";
	myLoadingscreen.style.height = "100%";
	myLoadingscreen.style.width = "100%";
	myLoadingscreen.style.zIndex = "999";
	myLoadingscreen.style.backgroundColor = "#CCCCCC";
	myLoadingscreen.style.cursor = "wait";
	loadingscreen.parentNode.appendChild(myLoadingscreen);
};
function setLoadingScreenMessage(urlString,c1,c2){
	var msg = "Loading "+urlString.substring(urlString.lastIndexOf('/')+1)+" ("+c1+"/"+c2+")";
	myLoadingscreen.innerHTML = "<div style='position:absolute;top:300px;width:100%;text-align:center'>"+msg+"</div>";
};
function createIFrame(url){
	var frame = webMI.dom.createElement("http://www.w3.org/1999/xhtml", "iframe");
	frame.frameBorder = "0";
	frame.scrolling = "no";
	frame.style.width = "100%";
	frame.style.height = "100%";
	if (url) frame.src = url;
	return frame;
};
function attachLoadEvent(frame, additional, callback){
	if (!tabHandler.hasIFrameEvent(frame)){
		webMI.addEvent(frame, "load", function(e) {
			if (additional!=null) additional();
			addOnLoadFrame(frame);
			addOnLoadAllFrame(frame,callback);
		});
		tabHandler.setIFrameHasEvent(frame);
	}
};
function addOnLoadFrame(frame){
	tabHandler.setIFrameLoaded(frame,true);
	tabHandler.registerDisplay(frame.contentWindow.document);
	var contentWin;
	if ((contentWin = frame.contentWindow) && contentWin.webMI){
		contentWin.webMI.addOnfocus(function(){
			if (contentWin != null)
				tabHandler.getFocused(contentWin.document);
		});
		contentWin.webMI.addOnunload(function(){
			try {contentWin} catch(err){return;}
			if (contentWin != null){
				tabHandler.removeDoc(contentWin.document);
			}
		});
	}
	var element = frame.contentDocument ? frame.contentDocument : contentWin.document;
	webMI.addEvent(element, ["click","keypress","touchstart"], function(e) {
		webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.AutoLogout", {"action":"restartTimer"});
	});
	webMI.addEvent(element, "touchstart", function(e) {
		webMI.display.showPopup(0, 0, null);
	});
	consistencyHandler.read();
};
function addOnLoadAllFrame(frame,callback){
	if (!tabHandler.areAllIFrameLoaded()) {if (frame && frameName==defaultFrameName){tabHandler.addAfterIFrameLoad(callback);} return;};
	tabHandler.beforeFirstUse(frame.contentWindow.document,false,callback);
	tabHandler.runAfterIFrameLoad();
};

webMI.addOnload(function() {
	zoomAreaDiv.style.display = "none";
	if (isNavigationFrame) {
		if (zoomAreaDiv != null && zoomBoxDiv != null) {
			zoomBoxParent = zoomBoxDiv.parentNode;
			zoomAreaDiv.style.zIndex = "100";
			zoomBoxDiv.style.zIndex = "100";
			zoomBoxDiv.style.display = "none";
			zoomBoxDiv.style.border = "1px solid black";
			zoomAreaDiv.style.cursor = "crosshair";
			webMI.addEvent(zoomArea, "mousedown", zoomMouseDown);
			webMI.addEvent(zoomArea, "mousemove", zoomMouseMove);
			webMI.addEvent(zoomArea, "mouseup", zoomMouseUp);
			webMI.addEvent(zoomBoxDiv, "mousedown", zoomMouseDown);
			webMI.addEvent(zoomBoxDiv, "mousemove", zoomMouseMove);
			webMI.addEvent(zoomBoxDiv, "mouseup", zoomMouseUp);
		}

		webMI.keys.addDownListener(function() {
			if (!mousedownpos1 && !olddisplaystyle) {
				mousedownpospan = null;
				olddisplaystyle = "block";
				zoomAreaDiv.style.display = "block";
				zoomAreaDiv.style.cursor = "move";
			}
		}, 18);

		webMI.keys.addUpListener(function() {
			if (olddisplaystyle) {
				zoomAreaDiv.style.cursor = "crosshair";
				zoomAreaDiv.style.display = "none";
				olddisplaystyle = null;
			}
		}, 18);

		webMI.addOnfocus(function(e) {
			mousedownpos1 = null;
			mousedownpos2 = null;
			updateZoomBox();
			zoomAreaDiv.style.display = "none";
		});

		addNavigationTriggers();
	}
	webMI.gfx.setVisible("stroke", false);
	webMI.gfx.setVisible("label", false);
	webMI.gfx.setVisible("label2", false);

	webMI.trigger.fire("com.atvise.display_structure", function(e, preload, excludePreload, includePreload, loadingscreen, firstConnect) {
		if (e != null) {
			var displayConfig = e;
			urlPrefix = "/"+displayConfig["prefix"];
			urlPostfix = displayConfig["postfix"];
			preloaded = preload;

			if (preloaded) {
				webMI.trigger.connect("register.preload.resume", function(e) {
					resumeCallbackObjects.push(e.value);
				});
			}

			excludePreloaded = excludePreload;
			includePreloaded = includePreload;
			var defaultPage = (firstConnect.defaultUrl == "")?webMI.display.createURL(displayConfig["default"]):firstConnect.defaultUrl;
			var firstFire = firstConnect.value && (webMI.query.isDefault == "true");
			if (firstFire) {
				firstConnect.value = false;
				firstConnect.defaultFrameName = frameName;
				defaultFrameName = frameName;
				webMI.display.setOpenUrlHandler(function(url,frame) {
					frame = (typeof frame != "string" || frame==null)?firstConnect.defaultFrameName:frame;
					function changeDisplay(){
						var iframe = tabHandler.getIFrame(frame);
						if (iframe == null) iframe = tabHandler.getIFrame(firstConnect.defaultFrameName);
						if (iframe != null){
							if (frame != firstConnect.defaultFrameName){
								changeFrame_(url,iframe)
							} else {
								(iframe!=null) && changeFrame(url,iframe);
							}
						}
					}
					if (tabHandler.areAllIFrameLoaded()){
						changeDisplay();
					} else {
						tabHandler.addAfterIFrameLoad(changeDisplay);
					}
				});
				webMI.addEvent(webMI.data, "clientvariableschange", function(e) {
					if ("CCDexceeded" in e && e["CCDexceeded"]){
						if (firstCCDExceeded){
							alert("CCD exceeded!");
							firstCCDExceeded = false;
						} else console.warn("CCD exceeded!");
					}
				});
			}
			if (firstFire && (preload || (!preload && includePreloaded.length > 0))) {
				var displays = [];
				var urls = [];
				var ucount1 = 0, ucount2 = 0;
				function allLoadedCallback(frame){
					if (runOnce){
						runOnce = false;
						changeFrame(targetUrl);
						loadingscreen.parentNode.removeChild(myLoadingscreen);
					} else {
						frame && frameName == firstConnect.defaultFrameName && tabHandler.getFocused(frame.contentWindow.document);
					}
				}
				function extractMenu(menu,prefix,allSub) {
					var NORMAL = 0; var ALL_BELOW = 1; var NONE_BELOW = 2;
					allSub = allSub||NORMAL;
					for (var i in menu) {
						var menuItem = menu[i];
						var menuItemName = (menuItem.identifier)?menuItem.identifier:prefix+"."+menuItem.name;
						if (menuItem.sub) {
							if (allSub == ALL_BELOW || isInArray(includePreloaded,menuItemName)){
								extractMenu(menuItem.sub,menuItemName,ALL_BELOW);
							} else if (allSub == NONE_BELOW || isInArray(excludePreloaded,menuItemName)){
								extractMenu(menuItem.sub,menuItemName,NONE_BELOW);
							} else {
								extractMenu(menuItem.sub,menuItemName,allSub);
							}
						}
						if (menuItem.display && allSub == ALL_BELOW){
							includePreloaded[includePreloaded.length] = menuItem.display;
							displays.push(menuItem.display);
						} else if (menuItem.url && allSub == ALL_BELOW){
							includePreloaded[includePreloaded.length] = menuItem.url;
							urls.push(menuItem.url);
						} else if (menuItem.display && allSub == NONE_BELOW){
							excludePreloaded[excludePreloaded.length] = menuItem.display;
						} else if (menuItem.url && allSub == NONE_BELOW){
							excludePreloaded[excludePreloaded.length] = menuItem.url;
						} else if (menuItem.display && preload && (excludePreloaded.length == 0 || !isInArray(excludePreloaded,menuItemName,menuItem.display))) {
							displays.push(menuItem.display);
						} else if (menuItem.display && !preload && isInArray(includePreloaded,menuItemName,menuItem.display)) {
							displays.push(menuItem.display);
						} else if (menuItem.url  && (excludePreloaded.length == 0 || !isInArray(excludePreloaded,menuItem.url))) {
							urls.push(menuItem.url);
						} else if (menuItem.url  && !preload && isInArray(includePreloaded,menuItem.url)) {
							urls.push(menuItem.url);
						}
					}
				};
				function addFrame(frameArray, isDisplay) {
					var url = frameArray.pop();
					if (url != undefined) {
						url = isDisplay ? webMI.display.createURL(url) : url;
						if (url == targetUrl || url == defaultPage) {
							addFrame(frameArray, isDisplay);
						} else {
							var preloadedFrame = createIFrame(url);
							preloadedFrames[url] = preloadedFrame;
							tabHandler.pushIFrame("",preloadedFrame);
							setLoadingScreenMessage(url,++ucount1,ucount2);
							attachLoadEvent(preloadedFrame, 
								function(){	
									addFrame(frameArray, isDisplay);
									preloadedFrame.contentWindow.webMI && preloadedFrame.contentWindow.webMI.data.pause();}, 
								allLoadedCallback);
							webMI.gfx.addForeignObject({x:0, y:0, width:800, height:600, childNodes: [preloadedFrame]}, iframegroup);
						}
					}
				};
				extractMenu(displayConfig.menu,"AGENT.DISPLAYS");
				ucount2 = displays.length+urls.length;
				if (includePreloaded.length == 0 && ucount2>0) ucount2--;
				else ucount2++
				createLoadingScreen(loadingscreen);
				preloadedFrames[targetUrl] = myFrame;
				tabHandler.pushIFrame(frameName,myFrame);
				setLoadingScreenMessage(targetUrl,++ucount1,ucount2)
				if (displays != undefined) {
					addFrame(displays, true);
				}
				if (urls != undefined) {
					addFrame(urls, false);
				}
				attachLoadEvent(myFrame,null,function(){allLoadedCallback(myFrame)});
				myFrame.src = targetUrl;				
				myExcldFrame = createIFrame();
				preloadedFrames["exclude"] = myExcldFrame;
				tabHandler.pushIFrame("",myExcldFrame);
				tabHandler.setIFrameLoaded(myExcldFrame,true);
				(webMI.gfx.addForeignObject({x:0, y:0, width:800, height:600, childNodes: [myExcldFrame]}, iframegroup)).style.display = "none";
			} else {
				tabHandler.pushIFrame(frameName,myFrame);
				changeFrame_(targetUrl,myFrame);
			}
		}
	});
});

/**
 * calculate offset for zooming in nested iframes
 */
function getOffset(element, position) {
	position.x -= element.offsetLeft;
	position.y -= element.offsetTop;

	if (element.id == "foreignobjects")
		return position;

	return getOffset(element.parentNode, position);
}

function zoomMouseDown(e) {
	if(!e)
		e = window.event;

	if (e.preventDefault)
		e.preventDefault();

	if (olddisplaystyle != null) {
		var webMImyIframe = currentActiveFrame.contentWindow.webMI;
		var viewBox = webMImyIframe.display.getViewBox();
		var offset = getOffset(zoomBoxParent, {x: e.clientX, y: e.clientY});
		mousedownpospan = {x: offset.x, y: offset.y, viewBoxX: viewBox[0], viewBoxY: viewBox[1]};
		zoomAreaDiv.style.cursor = "move";
	} else {
		if (!mousedownpos1)
			mousedownpos1 = getOffset(zoomBoxParent, {x: e.clientX, y: e.clientY});
		else
			mousedownpos2 = getOffset(zoomBoxParent, {x: e.clientX, y: e.clientY});

		updateZoomBox();
	}
}

function zoomMouseMove(e) {
	if(!e)
		e = window.event;

	if (mousedownpospan) {
		var webMImyIframe = currentActiveFrame.contentWindow.webMI;
		var viewBox = webMImyIframe.display.getViewBox();
		var offset = getOffset(zoomBoxParent, {x: e.clientX, y: e.clientY});
		var viewBoxX = mousedownpospan.viewBoxX + viewBox[2] * (mousedownpospan.x - offset.x) / parseFloat(myIframeDiv.style.width);
		var viewBoxY = mousedownpospan.viewBoxY + viewBox[3] * (mousedownpospan.y - offset.y) / parseFloat(myIframeDiv.style.height);
		webMImyIframe.display.setViewBox(viewBoxX, viewBoxY, viewBox[2], viewBox[3]);
	} else {
		mousedownpos2 = getOffset(zoomBoxParent, {x: e.clientX, y: e.clientY});
		updateZoomBox();
	}
}

function updateZoomBox() {
	if(mousedownpos1 != null && mousedownpos2 != null) {
		var w = Math.abs(mousedownpos1.x - mousedownpos2.x);
		var h = Math.abs(mousedownpos1.y - mousedownpos2.y);

		if (w > 1) --w;
		if (h > 1) --h;

		zoomBoxDiv.style.display = "block";
		zoomBoxDiv.style.top = (mousedownpos1.y < mousedownpos2.y ? mousedownpos1.y : mousedownpos2.y) + "px";
		zoomBoxDiv.style.left = (mousedownpos1.x < mousedownpos2.x ? mousedownpos1.x : mousedownpos2.x) + "px";
		zoomBoxDiv.style.height = h + "px";
		zoomBoxDiv.style.width = w + "px";
	} else
		zoomBoxDiv.style.display = "none";
}

function zoomMouseUp(e) {
	if(!e)
		e = window.event;

	if (mousedownpospan) {
		mousedownpospan = null;
		zoomAreaDiv.style.cursor = "move";
	} else if (mousedownpos1 && mousedownpos2 && mousedownpos1.x != mousedownpos2.x && mousedownpos1.y != mousedownpos2.y) {
		var mainArea = {
			x: myIframeDiv.offsetLeft,
			y: myIframeDiv.offsetTop,
			w: parseFloat(myIframeDiv.style.width),
			h: parseFloat(myIframeDiv.style.height)
		};
		var h = parseFloat(zoomBoxDiv.style.height) / mainArea.h;
		var w = parseFloat(zoomBoxDiv.style.width) / mainArea.w;
		var x = (parseFloat(zoomBoxDiv.style.left) - mainArea.x) / mainArea.w;
		var y = (parseFloat(zoomBoxDiv.style.top) - mainArea.y) / mainArea.h;

		var webMImyIframe = currentActiveFrame.contentWindow.webMI;
		var viewBox = webMImyIframe.display.getViewBox();
		viewBox[0] = x * viewBox[2] + viewBox[0];
		viewBox[1] = y * viewBox[3] + viewBox[1];
		viewBox[3] = h * viewBox[3];
		viewBox[2] = w * viewBox[2];
		webMImyIframe.display.setViewBox(viewBox[0], viewBox[1], viewBox[2], viewBox[3]);

		mousedownpos1 = null;
		mousedownpos2 = null;
		updateZoomBox();
		zoomAreaDiv.style.display = "none";
	}
}

function changeFrame_(url,frame){
	firstCCDExceeded = true;
	consistencyHandler.renew();
	tabHandler.changeDisplay();
	frame.style.display = "";

	var cf = function() {
		frame.src = url;
		attachLoadEvent(frame, null, function(){tabHandler.getFocused(frame.contentWindow.document)});
	};

	//Fix Opera timeout problem
	if (navigator.userAgent.indexOf("Opera") > -1) {
		setTimeout(function(){
			frame.src = null;
			cf();
		}, 1);
	} else {
		cf();
	}
}

function changeFrame(url, frame) {
	var pureUrl = (url.indexOf("?")>-1)?url.substring(0,url.indexOf("?")):url;
	for (var i in preloadedFrames) {
			preloadedFrames[i].contentWindow.webMI && preloadedFrames[i].contentWindow.webMI.data.pause();
			preloadedFrames[i].parentNode.style.display = "none";
	}
	if (!preloaded && includePreloaded.length == 0 ) {
		myFrame.parentNode.style.display = "";
		changeFrame_(url, frame||myFrame);
	} else if ( (!preloaded && !isInArray(includePreloaded,pureUrl)) || (preloaded && isInArray(excludePreloaded,pureUrl)) ) {
		myExcldFrame.parentNode.style.display = "";
		currentActiveFrame = myExcldFrame;
		myIframeDiv = myExcldFrame.parentNode;
		changeFrame_(url, myExcldFrame);
	} else {
		var find = false;
		tabHandler.blurFocused();
		for (var i in preloadedFrames) {
			if (i == url || i == url.substring(0,url.indexOf("?")) ) {
				find = true;
				firstCCDExceeded = true;
				preloadedFrames[i].parentNode.style.display = "";
				var contentDocument = preloadedFrames[i].contentWindow.document;
				for (var j = 0; j < resumeCallbackObjects.length; ++j) {
					if (contentDocument == resumeCallbackObjects[j].document)
						resumeCallbackObjects[j].callback();
				}
				preloadedFrames[i].contentWindow.webMI && preloadedFrames[i].contentWindow.webMI.data.resume();
				currentActiveFrame = preloadedFrames[i];
				myIframeDiv = preloadedFrames[i].parentNode;
				tabHandler.getFocused(preloadedFrames[i].contentWindow.document);
			}
		}
		if (!find){ // alarmlist, historylist
			if (myExcldFrame == null ) myExcldFrame = frame||myFrame;
			myExcldFrame.parentNode.style.display = "";
			currentActiveFrame = myExcldFrame;
			myIframeDiv = myExcldFrame.parentNode;
			changeFrame_(url, myExcldFrame);
		}
	}
}

webMI.trigger.connect("getSource_" + frameName, function(e) {
	var src = currentActiveFrame.src;
	if (currentActiveFrame.src.indexOf("/") > -1) {
		var parts = currentActiveFrame.src.split("/");
		src = parts[parts.length-1];
	}
	if (src.indexOf("?") > -1) {
		src = src.substring(0, src.indexOf("?"));
	}
	e.value(src, currentActiveFrame.contentWindow.webMI);
});

function addNavigationTriggers() {
	webMI.trigger.connect("changeDisplay_" + frameName, function(e) {
		var url = e.value;
		var query;

		if (typeof e.value == "object") {
			url = e.value.url;
			query = e.value.query;
		} else {
			var indexOfQuestionMark = url.indexOf("?", 1);
			if (indexOfQuestionMark > 0) {
				query = url.substring(indexOfQuestionMark + 1);
				url = url.substring(0, indexOfQuestionMark);
			}
		}

		if (url != undefined)
			webMI.display.openUrl(webMI.display.createURL(url), query, frameName);
	});
	// 0...x, 1...y, 2...w, 3...h
	var zoomFactor = 0.1;
	webMI.trigger.connect("com.atvise.zoomIn_" + frameName, function(e) {
		var webMImyIframe = currentActiveFrame.contentWindow.webMI;
		var viewBox = webMImyIframe.display.getViewBox();
		viewBox[3] /= 1+zoomFactor;
		viewBox[2] /= 1+zoomFactor;
		viewBox[0] += viewBox[2] * zoomFactor / 2;
		viewBox[1] += viewBox[3] * zoomFactor / 2;
		webMImyIframe.display.setViewBox(viewBox[0], viewBox[1], viewBox[2], viewBox[3]);
	});
	webMI.trigger.connect("com.atvise.zoomOut_" + frameName, function(e) {
		var webMImyIframe = currentActiveFrame.contentWindow.webMI;
		var viewBox = webMImyIframe.display.getViewBox();
		viewBox[0] -= viewBox[2] * zoomFactor / 2;
		viewBox[1] -= viewBox[3] * zoomFactor / 2;
		viewBox[3] *= 1+zoomFactor;
		viewBox[2] *= 1+zoomFactor;
		webMImyIframe.display.setViewBox(viewBox[0], viewBox[1], viewBox[2], viewBox[3]);
	});
	webMI.trigger.connect("com.atvise.zoom11_" + frameName, function(e) {
		var webMImyIframe = currentActiveFrame.contentWindow.webMI;
		var viewBox = webMImyIframe.display.getInitialViewBox();
		webMImyIframe.display.setViewBox(viewBox[0], viewBox[1], viewBox[2], viewBox[3]);
	});
	webMI.trigger.connect("com.atvise.zoomRect_" + frameName, function(e) {
		mousedownpospan = null;
		zoomAreaDiv.style.display = "block";
	});
	webMI.trigger.connect("com.atvise.getDefaultDisplay_" + frameName, function(e) {
		e.value(display,url);
	});
}

//workaround for [AT-D-3223]

if (navigator.userAgent.indexOf("Firefox") != -1) {
	if (webMI.display.getURLPrefix() == "") {
		console.warn("Reloading because of empty URL prefix - Firefox Bug 301325");
		window.window.location.reload();
	}
}
},{},{"frameName":"myframe","isDefault":"true","isNavigationFrame":"false"}],"3":[function(webMI,window,document,self){webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"font family", "id":"id_0", "key":"FontFamily", "property":""});
},{},{}]},window);
//]]></script>
 </body>
</html>
