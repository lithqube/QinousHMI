<?xml version="1.0" encoding="UTF-8"?>
<html xmlns:a="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/" xmlns:atv="http://webmi.atvise.com/2007/svgext" xmlns:atvise="http://www.atvise.com/" xmlns:cc="http://web.resource.org/cc/" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:svg="http://www.w3.org/2000/svg" xmlns:svgmaker="http://www.svgmaker.com/svgns" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <title></title>
  <style>v\:*{behavior:url(#default#VML)}body{overflow:hidden}</style>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
 </head>
 <body>
  <v:group atv:coordfactor="100" atv:oe="2BC6E3AAC3D6S2RF5A9D9789D8F5G38FA6CALCK4G9P1F1PCCE8DG48CE6BGHDJ8A" coordsize="96400,60000" id="webmivmlroot" style="height:600px;left:0;position:absolute;top:0;visibility:hidden;width:964px">
   <v:oval fillcolor="#468888" id="id_40" strokecolor="#51e8e0" stroked="true" strokeweight="3" style="height:57400px;left:66000px;top:-16600px;width:57400px"/>
   <v:group coordorigin="-37885,73" coordsize="200000,110628" style="height:110628px;left:-37885px;top:73px;width:200000px">
    <v:group atv:origx="56950" atv:origy="55800" atv:refpx="592.5" atv:refpy="527.5" coordsize="10500,3500" id="TimePicker" style="height:3500px;left:0;top:0;width:10500px">
     <v:roundrect arcsize="0.159" atv:refpx="62209" atv:refpy="57505" filled="false" id="TimePicker_brdr_button" strokecolor="#647A8F" stroked="true" strokeweight="0.75" style="height:3350px;left:57025px;top:55875px;width:10350px"/>
     <v:rect fillcolor="#bee5c1" id="id_26" strokecolor="#08878b" stroked="true" strokeweight="0.75" style="height:9600px;left:114050px;top:101100px;width:28100px"/>
     <v:group atv:origtransform="matrix(0.9613,0,0,1.0531,0,0)" coordorigin="-37885,73" coordsize="200000,75729" style="height:75729px;left:-37885px;top:73px;width:200000px">
      <v:group atv:bindbr="1,1" atv:bindtl="0,0" atv:origx="416" atv:origy="190" atv:refpx="52.064" atv:refpy="18.323" coordsize="10000,3000" id="TimePicker_button" style="height:3000px;left:0;top:0;width:10000px">
       <v:shapetype id="2linear_12">
        <v:fill angle="180" colors="0 #484848, 1 #000000, 1 #000000" method="none" rotate="true" type="gradient"/>
       </v:shapetype>
       <v:shapetype id="2linear_0">
        <v:fill angle="0" colors="0 #494949, 0.0437 #494949, 0.9104 #000000, 1 #000000" method="none" rotate="true" type="gradient"/>
       </v:shapetype>
       <v:shapetype id="2linear_1">
        <v:fill angle="180" colors="0 #ffffff, 0.5433 #ffffff, 1 #ffffff, 1 #ffffff" method="none" rotate="true" type="gradient"/>
       </v:shapetype>
       <v:shapetype id="2linear_2">
        <v:fill angle="0" colors="0 #ffffff, 0.5617 #ffffff, 1 #ffffff" method="none" rotate="true" type="gradient"/>
       </v:shapetype>
       <v:group atv:bindbr="1,1" atv:bindtl="0,0" atv:origtransform="matrix(1.0004,0,0,0.9662,-0.0198,0.0235)" atv:refpx="62156" atv:refpy="57580" coordorigin="-37885,73" coordsize="200000,75729" id="TimePicker_button_button_clickarea" style="height:75729px;left:-37885px;top:73px;width:200000px">
        <v:roundrect arcsize="0.138" atv:bindbr="1,1" atv:bindtl="0,0" atv:refpx="62157" atv:refpy="57580" fillcolor="#FFFFFF" id="TimePicker_button_id_2" strokecolor="647a8f" stroked="true" strokeweight="0.74" style="height:3152px;left:57351px;top:56004px;width:9611px"/>
        <v:roundrect arcsize="0.158" atv:bindbr="1,1" atv:bindtl="0,0" atv:refpx="62157" atv:refpy="57580" filled="false" id="TimePicker_button_button_bg" strokecolor="647a8f" stroked="true" strokeweight="0.74" style="height:3056px;left:57401px;top:56052px;width:9511px"/>
        <v:line fillcolor="#8f2b6e" from="63695,103418" id="id_14" strokecolor="#759a4a" stroked="true" strokeweight="1.48" to="132456,86935">
         <v:stroke joinstyle="miter"/>
        </v:line>
        <v:group atv:origtransform="matrix(1.0397,0,0,0.9488,0,0)" coordorigin="131,73" coordsize="105295,75729" style="height:75729px;left:131px;top:73px;width:105295px">
         <v:group atv:bindbr="0.5,0.5" atv:bindtl="0.5,0.5" atv:origx="4084" atv:origy="909" atv:refpx="50" atv:refpy="15.5" coordsize="2000,2000" id="TimePicker_button_button_symbol" style="height:2000px;left:0;top:0;visibility:hidden;width:2000px">
          <v:shapetype id="3linearGradient2250">
           <v:fill angle="270" colors="0 #008700, 1 #006f00" method="none" rotate="true" type="gradient"/>
          </v:shapetype>
          <v:polyline atv:matrix="0.9999,0,0,0.9654,614.3184,568.7982" atv:refpx="62432" atv:refpy="57845" fillcolor="#FFFFFF" id="TimePicker_button_button_symbol_id_3" points="61698,57858 61562,57993 62209,58741 63301,57040 63165,56950 62155,58157 61698,57858 " stroked="false" strokeweight="0.74"/>
          <v:oval fillcolor="#9e8acb" id="id_37" strokecolor="#e52940" stroked="true" strokeweight="1.47" style="height:35141px;left:69031px;top:40661px;width:36395px"/>
         </v:group>
        </v:group>
        <v:line atv:bindbr="0.5,0.5" atv:bindtl="0.5,0.5" atv:refpx="5000" atv:refpy="1550" from="-37885 59710" id="TimePicker_button_button_label" style="visibility:inherit" to="162115 59810">
         <v:skew matrix="0.9999,0,0,0.9654" on="true" origin="-0.31058,-597.59524"/>
         <v:path textpathok="true"/>
         <v:fill color="#647A8F" on="true"/>
         <v:stroke on="false"/>
         <v:textpath on="true" string="Pick Date" style="font-family:'Open Sans';font-size:16px;v-text-align:center"/>
        </v:line>
        <v:roundrect arcsize="0.111" atv:bindbr="1,1" atv:bindtl="0,0" atv:refpx="62157" atv:refpy="57580" filled="false" id="TimePicker_button_button_stroke" stroked="false" strokeweight="0.74" style="height:3056px;left:57401px;top:56052px;width:9511px"/>
       </v:group>
      </v:group>
     </v:group>
    </v:group>
   </v:group>
   <v:polyline fillcolor="#da37a3" id="id_8" points="35300,33400 93900,30500 43300,50700 29600,37900 57400,46500 17400,29200 48300,46900 77400,4000 100,15800 1400,15000 79600,38700 37300,52300 " strokecolor="#ff60f6" stroked="true" strokeweight="3">
    <v:stroke joinstyle="miter"/>
   </v:polyline>
   <v:group atv:origtransform="matrix(1,0,0,1,29.5,48)" atv:refpx="30200" atv:refpy="52800" coordorigin="-66850,3300" coordsize="200000,56050" id="bttn_hour" style="height:56050px;left:-66850px;top:3300px;width:200000px">
    <v:polyline atv:matrix="1,0,0,1,29.5,48" fillcolor="#8cf1c8" id="id_30" points="16250,47100 74050,44600 82350,8100 97150,52400 19150,58400 8150,63900 22650,45400 43650,50200 47550,55600 26750,10800 58550,62700 57950,15300 " strokecolor="#a94159" stroked="true" strokeweight="3">
     <v:stroke joinstyle="miter"/>
    </v:polyline>
    <v:roundrect arcsize="0.137" atv:refpx="24107" atv:refpy="62491" filled="false" id="brdr_button" strokecolor="#647A8F" stroked="true" strokeweight="0.75" style="height:3500px;left:29000px;top:55850px;width:8300px"/>
    <v:polyline atv:matrix="1,0,0,1,29.5,48" fillcolor="#24a3fd" id="id_15" points="3550,12200 33750,15300 85350,28600 90850,58800 55250,22800 73750,30500 59950,63900 48250,23600 46150,46700 58050,32300 91850,63400 " strokecolor="#28b012" stroked="true" strokeweight="3.75">
     <v:stroke joinstyle="miter"/>
    </v:polyline>
    <v:line fillcolor="#19b2e8" from="50350,17200" id="id_39" strokecolor="#d8e30e" stroked="true" strokeweight="3" to="84450,20100">
     <v:stroke joinstyle="miter"/>
    </v:line>
    <v:line atv:refpx="30200" atv:refpy="52850" from="-66850 57517" id="txt_taskname" to="133150 57617">
     <v:path textpathok="true"/>
     <v:fill color="#647a8f" on="true"/>
     <v:stroke on="false"/>
     <v:textpath on="true" string="Hour" style="font-family:'Varela Round';font-size:16px;v-text-align:center"/>
    </v:line>
    <v:oval fillcolor="#13e353" id="id_22" strokecolor="#e89835" stroked="true" strokeweight="3" style="height:12600px;left:11250px;top:7100px;width:12600px"/>
   </v:group>
   <v:group atv:origtransform="matrix(1,0,0,1,32.8333,48)" atv:refpx="39533" atv:refpy="52800" coordorigin="-57517,14300" coordsize="200000,45050" id="bttn_day" style="height:45050px;left:-57517px;top:14300px;width:200000px">
    <v:roundrect arcsize="0.137" atv:refpx="23441" atv:refpy="59991" filled="false" id="id_6" strokecolor="#647A8F" stroked="true" strokeweight="0.75" style="height:3500px;left:38333px;top:55850px;width:8300px"/>
    <v:line atv:refpx="22307" atv:refpy="54800" from="-57517 57517" id="id_7" to="142483 57617">
     <v:path textpathok="true"/>
     <v:fill color="#647a8f" on="true"/>
     <v:stroke on="false"/>
     <v:textpath on="true" string="Day" style="font-family:'Varela Round';font-size:16px;v-text-align:center"/>
    </v:line>
    <v:polyline atv:matrix="1,0,0,1,32.8333,48" fillcolor="#df79fd" id="id_19" points="43283,21800 65383,21600 93183,19100 4783,61800 5983,46700 " strokecolor="#7ba495" stroked="true" strokeweight="1.5">
     <v:stroke joinstyle="miter"/>
    </v:polyline>
   </v:group>
   <v:group atv:origtransform="matrix(1,0,0,1,36.1667,48)" atv:refpx="48867" atv:refpy="52800" coordorigin="-48183,3400" coordsize="200000,55950" id="bttn_week" style="height:55950px;left:-48183px;top:3400px;width:200000px">
    <v:roundrect arcsize="0.137" atv:refpx="21774" atv:refpy="59991" filled="false" id="id_9" strokecolor="#647A8F" stroked="true" strokeweight="0.75" style="height:3500px;left:47667px;top:55850px;width:8300px"/>
    <v:rect fillcolor="#5841f1" id="id_35" strokecolor="#a5693a" stroked="true" strokeweight="0.75" style="height:2700px;left:30817px;top:46800px;width:42500px"/>
    <v:line atv:refpx="16449" atv:refpy="54800" from="-48183 57517" id="id_10" to="151817 57617">
     <v:path textpathok="true"/>
     <v:fill color="#647a8f" on="true"/>
     <v:stroke on="false"/>
     <v:textpath on="true" string="Week" style="font-family:'Varela Round';font-size:16px;v-text-align:center"/>
    </v:line>
    <v:polyline atv:matrix="1,0,0,1,36.1667,48" fillcolor="#50dbc9" id="id_34" points="82217,8200 44217,54300 61617,61000 84117,46500 65617,41500 37717,47400 93917,27000 35617,19500 56217,17700 65817,39100 32917,22400 62117,15400 " strokecolor="#d214d1" stroked="true" strokeweight="3">
     <v:stroke joinstyle="miter"/>
    </v:polyline>
   </v:group>
   <v:group atv:origtransform="matrix(1,0,0,1,-65,53)" atv:refpx="2650" atv:refpy="52600" coordorigin="200,5300" coordsize="82100,55239" id="bttn_past" style="height:55239px;left:200px;top:5300px;width:82100px">
    <v:group atv:origtransform="matrix(0.0625,0,0,0.1087,0,0)" coordorigin="1000,5300" coordsize="71300,53704" style="height:53704px;left:1000px;top:5300px;width:71300px">
     <v:group atv:origx="119993" atv:origy="464615" atv:refpx="83.001" atv:refpy="521" coordsize="25600,29440" id="id_4" style="height:29440px;left:0;top:0;width:25600px">
      <!-- Generated by IcoMoon.io -->
      <v:shape atv:refpx="1800" atv:refpy="57404" coordorigin="1000,55804" coordsize="1600,3200" fillcolor="#647a8f" id="id_4_id_0" stroked="false" strokeweight="0.09" style="height:3200px;left:1000px;top:55804px;width:1600px">
       <v:path v="m2599,55804l2600,59004l1000,57404l2599,55804"/>
       <v:stroke joinstyle="miter"/>
      </v:shape>
      <v:line fillcolor="#d5c12f" from="4737,56380" id="id_21" strokecolor="#200b0c" stroked="true" strokeweight="0.32" to="5518,60967">
       <v:stroke joinstyle="miter"/>
      </v:line>
     </v:group>
    </v:group>
    <v:group atv:origtransform="matrix(0.0625,0,0,0.1087,0,0)" coordorigin="200,22500" coordsize="82100,38039" style="height:38039px;left:200px;top:22500px;width:82100px">
     <v:group atv:origx="147200" atv:origy="464581" atv:refpx="98.001" atv:refpy="520.999" coordsize="25600,29440" id="id_5" style="height:29440px;left:0;top:0;width:25600px">
      <!-- Generated by IcoMoon.io -->
      <v:rect fillcolor="#b5371a" id="id_27" strokecolor="#dced41" stroked="true" strokeweight="0.06" style="height:533px;left:4488px;top:60007px;width:56px"/>
      <v:shape atv:refpx="3500" atv:refpy="57400" coordorigin="2700,55800" coordsize="1600,3200" fillcolor="#647a8f" id="id_5_id_0" stroked="false" strokeweight="0.09" style="height:3200px;left:2700px;top:55800px;width:1600px">
       <v:path v="m4300,55800l4300,59000l2700,57400l4300,55800"/>
       <v:stroke joinstyle="miter"/>
      </v:shape>
      <v:polyline atv:matrix="0.0625,0,0,0.1087,27,558" fillcolor="#bb34cf" id="id_25" points="5231,60605 6844,60659 3325,60126 5706,61724 6088,58474 2713,58246 7844,59268 3081,58876 " strokecolor="#bf9d76" stroked="true" strokeweight="0.13">
       <v:stroke joinstyle="miter"/>
      </v:polyline>
     </v:group>
    </v:group>
   </v:group>
   <v:group atv:origtransform="matrix(-1,0,0,1,1028.9953,53)" atv:refpx="93750" atv:refpy="52600" coordorigin="29100,-61605" coordsize="67100,120608" id="bttn_future" style="height:120608px;left:29100px;top:-61605px;width:67100px">
    <v:group atv:origtransform="matrix(0.0625,0,0,0.1087,0,0)" coordorigin="93800,55804" coordsize="1600,3200" style="height:3200px;left:93800px;top:55804px;width:1600px">
     <v:group atv:origx="119993" atv:origy="464615" atv:refpx="83.001" atv:refpy="521" coordsize="25600,29440" id="id_12" style="height:29440px;left:0;top:0;width:25600px">
      <!-- Generated by IcoMoon.io -->
      <v:shape atv:refpx="94600" atv:refpy="57404" coordorigin="93800,55804" coordsize="1600,3200" fillcolor="#647a8f" id="id_12_id_0" stroked="false" strokeweight="0.09" style="height:3200px;left:93800px;top:55804px;width:1600px">
       <v:path v="m93800,55804l93800,59004l95400,57404l93800,55804"/>
       <v:stroke joinstyle="miter"/>
      </v:shape>
     </v:group>
    </v:group>
    <v:oval fillcolor="#bb75f2" id="id_2" strokecolor="#db7d79" stroked="true" strokeweight="3" style="height:13800px;left:29100px;rotation:180;top:-15800px;width:60600px">
     <v:skew matrix="1,0,0,-1" on="true" origin="-0.98019,0.64493"/>
    </v:oval>
    <v:group atv:origtransform="matrix(0.0625,0,0,0.1087,0,0)" coordorigin="34500,-61605" coordsize="61700,120605" style="height:120605px;left:34500px;top:-61605px;width:61700px">
     <v:group atv:origx="147200" atv:origy="464581" atv:refpx="98.001" atv:refpy="520.999" coordsize="25600,29440" id="id_13" style="height:29440px;left:0;top:0;width:25600px">
      <!-- Generated by IcoMoon.io -->
      <v:rect fillcolor="#e5cd1c" id="id_36" strokecolor="#8bd502" stroked="true" strokeweight="0.32" style="height:174px;left:87925px;rotation:180;top:-60474px;width:1919px">
       <v:skew matrix="1,0,0,-1" on="true" origin="-46.32386,347.21216"/>
      </v:rect>
      <v:shape atv:refpx="92900" atv:refpy="57400" coordorigin="92100,55800" coordsize="1600,3200" fillcolor="#647a8f" id="id_13_id_0" stroked="false" strokeweight="0.09" style="height:3200px;left:92100px;top:55800px;width:1600px">
       <v:path v="m92100,55800l92100,59000l93700,57400l92100,55800"/>
       <v:stroke joinstyle="miter"/>
      </v:shape>
      <v:line fillcolor="#f3b995" from="91543,58289" id="id_23" strokecolor="#526ff2" stroked="true" strokeweight="0.13" to="87687,61213">
       <v:stroke joinstyle="miter"/>
      </v:line>
      <v:oval fillcolor="#2c6d1e" id="id_16" strokecolor="#94f5ca" stroked="true" strokeweight="0.06" style="height:1065px;left:87143px;rotation:180;top:-61605px;width:5863px">
       <v:skew matrix="1,0,0,-1" on="true" origin="-15.36453,57.33056"/>
      </v:oval>
     </v:group>
    </v:group>
   </v:group>
   <v:polyline fillcolor="#0ae59b" id="id_17" points="13400,39900 18000,4200 22300,17000 37000,53300 82100,36200 13900,31900 51500,24200 60400,26700 15600,34600 30100,42900 13400,39900 " strokecolor="#5d29d2" stroked="true" strokeweight="1.5"/>
   <v:shape atv:refpx="48207" atv:refpy="51706" coordorigin="45202,49401" coordsize="6001,6001" id="loader" style="height:6001px;left:45202px;top:49401px;visibility:hidden;width:6001px">
    <v:stroke dashstyle="1 1"/>
    <v:imagedata src="../../css/img/Preloader2.gif"/>
   </v:shape>
   <v:rect fillcolor="#63629d" id="id_11" strokecolor="#ede15c" stroked="true" strokeweight="3" style="height:30100px;left:45400px;top:28400px;width:48900px"/>
  </v:group>
  <div id="foreignObjects">
   <div id="cntnr_tabs" style="height:500px;left:0px;position:absolute;top:0px;width:964px">    <div style="width:100%;height:100%; margin: 0 auto" id="tabs"></div>
   </div>
  </div>
  <script type="text/javascript" src="../../webmi.js"></script>
  <script type="text/javascript" src="/js/jquery.min.js"></script>
  <script type="text/javascript" src="/js/stock/highstock.js"></script>
  <script type="text/javascript" src="/js/stock/highcharts-more.js"></script>
  <script type="text/javascript" src="/js/stock/modules/boost.js"></script>
  <script type="text/javascript" src="/js/stock/modules/data.js"></script>
  <script type="text/javascript" src="/js/stock/modules/exporting.js"></script>
  <script type="text/javascript" src="/js/stock/modules/no-data-to-display.js"></script>
  <script type="text/javascript" src="/scope.js"></script>
  <script type="text/javascript" src="/q/StdConstantsFunctions.js"></script>
  <script type="text/javascript" src="/q/DiagramFunctions.js"></script>
  <script type="text/javascript" src="/q/DiagramDatasets.js"></script>
  <script type="text/javascript">//<![CDATA[
webMI.proxy({"":[function(webMI,window,document,self){var $ = top.$;
//setTimeout(function() { chart.reflow(); }, 1);
var data = [];
var labels = [];
var dp_totalPower,
	dp_voltage,
	dp_frequency,
	container,
	chartOverview,
	chartPower,
	chartEnery;
var timelapse = 300000;
var bttn_past = document.getElementById("bttn_past"),
	bttn_hour = document.getElementById("bttn_hour"),
	bttn_day = document.getElementById("bttn_day"),
	bttn_week = document.getElementById("bttn_week"),
	TimePicker = document.getElementById("TimePicker"),
	bttn_future = document.getElementById("bttn_future");
var highchart;

const ENUM_HOUR = 0;
const ENUM_DAY = 1;
const ENUM_WEEK = 2;
const ENUM_MONTH = 3;

var time_OneHour = 1000*3600;
var time_OneDay = time_OneHour*24;
var time_OneWeek = time_OneDay*7;
var time_OneMonth = time_OneWeek*4;
var timeSpan = time_OneHour;
var startTime;


// TODO: 
// 1) store index results from getContent in onLoad function -- avoid requesting the TOC over and over again
// 2) reference on click of "Load More" button -- disable "load more" button if no more data available

// Datapoints connection -- these values will eventually be set using a trigger, and taken from the scope data. The var chartSpec here is shown as an example/default data structure. at a later date it will be updated using a trigger, which will include the correct data for the component being viewed
var chartSpec; 

var recorderSeriesList = [];
var tocList = [];
webMI.addOnload(function(a){
	webMI.gfx.setVisible("loader", true);
	console.log("I am requesting diagram data");

	webMI.trigger.fire("ChartInfoRequest");
});

webMI.trigger.connect("SetChartInfo", function(f){

	console.log("Diagram view has recieved the monitoring node!");
	var node = f.value[0];
	LocalTimeSystemTimeDiff = f.value[1];
	BrowserTimeSystemTimeDiff = f.value[2];
	var frontspec;

	// get the corresponding chartdata for this node
	// and extract the frontspec
	for (var i=0; i<ChartData.length; i++){
		if (ChartData[i].type == node.Type){
			chartSpec = ChartData[i].tabs[0].spec;	
			break;			
		}
	}

	
	// JQUERY TABS
	tabs = document.getElementById("tabs");
//	tabs.style.maxWidth = "1000px";
//	tabs.style.maxHeight = "565px";
//	tabs.style.minWidth = "857px";
//	tabs.style.minHeight = "484px";
	//tabs.style.position = "center";
	/*  $(function() {
		$(tabs).tabs();
	  });
	*/
	
	// HIGHCHARTS INTEGRATION
	// OVERVIEW
	var overview = document.getElementById("tabs");
	overview.style.maxWidth = "100%";
//	overview.style.textAlign = "center";
	$(function () {
        $(overview).highcharts('StockChart',{
    	chart: {
            type: 'spline',
            zoomType: 'xy',
			spacingBottom: 20,
			spacingTop: 5,
			spacingLeft: 20,
			spacingRight: 20,
			width: null,
	        height: null,
//			zoomType: 'xy',
			alignTicks: true,
			 loading: {
            labelStyle: {
                color: 'white'
            },
            style: {
                backgroundColor: 'gray'
            }
			},
			exporting:{
				enabled: false,
			},
			plotOptions: {
				},
			animation: {
				easing: 'easeOutBounce'
				},
			events: {
				load: function () {
		
					highchart = this;
					timeSpan = time_OneHour;			
					startTime = Date.now() - BrowserTimeSystemTimeDiff - timeSpan;
					// get historical data -- this will add data to each series -- must complete before loading chart!
					recorderSeriesList = [];
					for (var i=0; i<chartSpec.data.length; i++) {
		
						tocList.push({ toc: {}});
						recorderSeriesList.push([]);
						for (var j=0; j<chartSpec.data[i].series.length; j++){
		
							recorderSeriesList[recorderSeriesList.length -1].push(this.addSeries(chartSpec.data[i].series[j]));

						}
//						console.log("our series list", recorderSeriesList[i]);
						//Scope.querylookup(chartSpec.data[i].recorder, curPLCSytsemTime - 48*60 * 1000 * 60, curPLCSytsemTime, addQueriedDataToSeries(chartSpec.data[i], recorderSeriesList, LocalTimeSystemTimeDiff));
	
						// use get content -- read is limited to 10000 data points, and we want to decide for ourselves how to iterate to get the desired data. get content gives us the needed information.
						console.log("Looking up", getRecorderPrefix(node) + "_" + chartSpec.data[i].recorder);
						Scope.getContent(
					
							getRecorderPrefix(node) + "_" + chartSpec.data[i].recorder, 
							getContentAndAddSeries(
								tocList[i],
								chartSpec.data[i], 
								recorderSeriesList[i], 
								node,
								LocalTimeSystemTimeDiff, 
								startTime, 
								startTime + timeSpan));


					}
				}
			}
		},
		legend: {
            enabled: true
        },
		rangeSelector : {
			enabled : false
		},
		navigator: {
			enabled: false,
			height: 20
		},
		credits: {
			enabled: false
		},
		title: {
			text: 'Live Overview',
			x: -20 //center
		},
		xAxis: {
			type: 'datetime',
			ordinal:false
		},
		yAxis: chartSpec.yaxes,
		tooltip: {
			xDateFormat: '%d/%m/%Y - %H:%M:%S',
			shared: false
		}
		
      }) // end chart creation
    }); // end chart overview
//setTimeout(function() { highchart.reflow(); }, 1);

}); // end addOnload

webMI.trigger.connect("setLoader", function(f){
	var statusLoader = f.value;
	if (statusLoader == false){
	console.log("- - Hide loader - -");
	webMI.gfx.setVisible("loader", false);
	}
});

function RefreshDiagram(){

	//TODO -- set highlight of hour / week / day buttons

	switch (timeSpan){
		case time_OneHour:
			break;
		case time_OneDay:
			break;
		case time_OneWeek:
			break;		
		default:
			timeSpan = time_OneHour;
	}

//	console.log("REFRESHING DIAGRAM with ", startTime, startTime+timeSpan);
	while(highchart.series.length > 0){
	    highchart.series[0].remove(true);
	}
	recorderSeriesList = [];

//	console.log("cleared everything out");
	for (var i=0; i<chartSpec.data.length; i++) {

		recorderSeriesList.push([]);
		for (var j=0; j<chartSpec.data[i].series.length; j++){

//			console.log("Config object contents:", chartSpec.data[i].series[j].data = []);
			recorderSeriesList[recorderSeriesList.length -1].push(highchart.addSeries(chartSpec.data[i].series[j]));

		}
		addQueriedDataToSeries(
			tocList[i].toc,
			chartSpec.data[i], 
			recorderSeriesList[i], 
			LocalTimeSystemTimeDiff, 
			startTime, 
			startTime + timeSpan);
	}

}

// Buttons
webMI.addEvent("bttn_past", ["mouseover","touchstart"], function(e){
	bttn_past.setAttribute('style', "cursor: pointer;");
});
webMI.addEvent("bttn_future", ["mouseover","touchstart"], function(e){
	bttn_future.setAttribute('style', "cursor: pointer;");
});
webMI.addEvent("bttn_day", ["mouseover","touchstart"], function(e){
	bttn_day.setAttribute('style', "cursor: pointer;");
});
webMI.addEvent("bttn_hour", ["mouseover","touchstart"], function(e){
	bttn_hour.setAttribute('style', "cursor: pointer;");
});
webMI.addEvent("bttn_week", ["mouseover","touchstart"], function(e){
	bttn_week.setAttribute('style', "cursor: pointer;");
});
webMI.addEvent("TimePicker", ["mouseover","touchstart"], function(e){
	TimePicker.setAttribute('style', "cursor: pointer;");
});

webMI.addEvent("bttn_past", "click", function(e) {
	startTime = startTime - timeSpan;
	RefreshDiagram();
});

webMI.addEvent("bttn_future", "click", function(e) {
	startTime = Math.min(startTime + timeSpan, Date.now() - BrowserTimeSystemTimeDiff - timeSpan);
	RefreshDiagram();
});

webMI.addEvent("bttn_day", "click", function(e) {
	if (timeSpan != time_OneDay){
		timeSpan = time_OneDay;
		startTime = Math.min(startTime, Date.now() - time_OneDay);
		RefreshDiagram();
	}
});

webMI.addEvent("bttn_hour", "click", function(e) {
	if (timeSpan != time_OneHour){
		timeSpan = time_OneHour;
		RefreshDiagram();
	}
});

webMI.addEvent("bttn_week", "click", function(e) {
	if (timeSpan != time_OneWeek){
		timeSpan = time_OneWeek;
		RefreshDiagram();
	}
});

webMI.trigger.connect("valuechanged", function(e){
//	console.log("Date time picker update??", e);
	if (e.value !== undefined){
		startTime = e.value;
		RefreshDiagram();
	}
});

webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"font family", "id":"txt_taskname", "key":"FontFamily", "property":""});
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"font family", "id":"id_7", "key":"FontFamily", "property":""});
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"font family", "id":"id_10", "key":"FontFamily", "property":""});
},{"TimePicker":["1",{}],"id_12":["4",{}],"id_13":["4",{}],"id_4":["4",{}],"id_5":["4",{}]},{}],"1":[function(webMI,window,document,self){var _value = 0,
	name = webMI.query.name;
webMI.addEvent("button", ["click","touchend"], function(e) {

	webMI.display.openWindow({
		display:"00000009",
		extern:false,
		height:400,
		menubar:false,
		modal:true,
		movable:false,
		resizable:true,
		scrollbars:false,
		status:false,
		title:'',
		toolbar:false,
		width:600,
		query: {
			value: _value,
			popupId: name
		}
	});
}, "button");


function updateDisplay(write) {
	var date = new Date(_value),
		dateString = date.toLocaleDateString();

	
	webMI.gfx.setText('button_button_label', dateString);
	webMI.trigger.fire("valuechanged", _value, "");

	if (write && webMI.query.base && webMI.query.base != '') webMI.data.write([webMI.query.base], [_value]);
}

// initial update
webMI.addOnload(function() {
/*	
	if (!webMI.query.base || webMI.query.base == '') updateDisplay();
	else {
		webMI.data.read(webMI.query.base, function(e) {
			_value = e.value;
			updateDisplay();
		});
		webMI.data.subscribe(webMI.query.base, function(e) {
			_value = e.value;
			updateDisplay();
		});
	}
*/
});

webMI.trigger.connect('com.atvise.datepicker_' + name, function(e) {
	_value = e.value;
	updateDisplay(true);
})

// Reset frame and text scaling
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.ResetScaling", { callback: function(originalSize, renderedSize, scale, scaleInverse) {
	webMI.gfx.setScaleX('button_button_label', scaleInverse.x);

	webMI.gfx.setScaleX('button_id_2', scaleInverse.x);
	webMI.gfx.setWidth('button_id_2', renderedSize.width);
	webMI.gfx.setMoveX('button_id_2', -(renderedSize.width - originalSize.width) / 2);

	webMI.gfx.setScaleX('button_button_stroke', scaleInverse.x);
	webMI.gfx.setWidth('button_button_stroke', (originalSize.width * scale.x) - 1);
	webMI.gfx.setMoveX('button_button_stroke', -(renderedSize.width - originalSize.width) / 2);
}, originalWidth: 100, originalHeight: 31, innerNode: document.getElementById('button') });

// TwoHand support
var _active = true;
function setActive(value) {
	webMI.trigger.fire('com.atvise.setActive', value || _active, 'button');
}
//webMI.trigger.connect('com.bachmann.themechange', function() { setActive(_active) });
webMI.trigger.connect('com.atvise.setActive', function(e) {
	setActive(_active = e.value);
});
},{"button":["2",{"fillColor":{b:"backgroundColor",v:""},"fillColorInactive":{b:"fillInactive",v:""},"focusStrokeColor":{b:"strokeFocus",v:""},"fontColor":{v:"#647A8F"},"label":{v:"Pick Date"},"strokePressed":{b:"strokePressed",v:""}}]},{"backgroundColor":"#FFFFFF","fillInactive":"#FFFFFF","name":"pickerDate","strokeFocus":"#FFFFFF","strokePressed":"#FFFFFF"}],"4":[function(webMI,window,document,self){},{},{}],"2":[function(webMI,window,document,self){/* 

Action Button

Triggers a 'clicked' event

*/

var strokeNormal = "none";
var strokePressed = webMI.query["strokePressed"];
var focusStrokeColor = webMI.query["focusStrokeColor"];
//var fillColor = webMI.query["fillColor"];
var fillColorInactive = webMI.query["fillColorInactive"];
var display = webMI.query["display"];
var consistencyGroup = webMI.query["consistencyGroup"];
var consistencyFunction = webMI.query["consistencyFunction"];

if (consistencyGroup)
	var consistencyHandler = webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Consistency Handler");

var tabHandler = webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Tab Handler");
var tabIndex = (webMI.query["tabIndex"] == undefined) ? "" : webMI.query["tabIndex"];
var tooltip = (webMI.query["tooltip"] == undefined) ? "" : webMI.query["tooltip"];

var right = (webMI.query["right"] == undefined) ? "" : webMI.query["right"];
if (right.search(/SYSTEM\.SECURITY\.RIGHTS\./) != -1) {
	right = right.substring(23,right.length); //remove "prefix" SYSTEM.SECURITY.RIGHTS.
}

var active = false;
var hasRight = false;

if (right != "") {
	webMI.addEvent(webMI.data, "clientvariableschange", function(e) {
		hasRight=false;
		if (("username" in e) && (e.username != "")) {
				hasRight = webMI.hasRight(right);
		}
		deActivate();
	});
}

var activeValue = (webMI.query["activeValue"] == undefined) ? "" :webMI.query["activeValue"];
var activeNode = (webMI.query["activeNode"] == undefined) ? "" : webMI.query["activeNode"];
var nodeIsActive = false;

if ((activeNode != "") && (String(activeValue) != "")) {
	webMI.data.subscribe(activeNode, function(e) {
		var nodeActiveValue = e.value;
		if (typeof nodeActiveValue == "boolean") {
			nodeIsActive = (String(nodeActiveValue) == activeValue);
		} else if (typeof nodeActiveValue == "number") {
			try {
				var temp = parseFloat(activeValue);
				nodeIsActive = (nodeActiveValue == temp);
			} catch(e) {
				nodeIsActive = false;
			}
		} else {
			nodeIsActive = (nodeActiveValue == activeValue);
		}
		deActivate();
	});
} else {
	deActivate();
}

function deActivate(forceDeActivate) {
	if (typeof forceDeActivate !== "undefined" && forceDeActivate){
		active = false;
	} else if (right != "") {
		if ((String(activeValue) != "") && (activeNode != "")) {
			active=(nodeIsActive && hasRight);
		} else {
			active=hasRight;
		}
	} else {
		if ((String(activeValue) != "") && (activeNode != "")) {
			active=nodeIsActive;
		} else {
			active=true;
		}
	}
	if (active) {
		webMI.gfx.setFill("id_2", webMI.query["fillColor"]);
	//	webMI.gfx.setVisible("button_stroke", null);
	} else {
		webMI.gfx.setFill("id_2", webMI.query["fillColorInactive"]); // fillColorInactive
	//	webMI.gfx.setVisible("button_stroke", false);
	}
}

function release() {
	if (active) {
		webMI.gfx.setFill("button_stroke", "none"); // "url(#linear_1)"
//		webMI.gfx.setFill("button_bg", "none"); // added
		webMI.gfx.setStroke("button_stroke", strokeNormal);
	}
}

function focusTH(){
	if (active) {
		webMI.gfx.setStroke("button_stroke", webMI.query['focusStrokeColor']);
	}
}
function applyTH(){
	if (active){
		webMI.trigger.fire("clicked", true, "");
	}
	if (consistencyGroup)
		consistencyFunction == "write" ? consistencyHandler.write(consistencyGroup) : consistencyHandler.read(consistencyGroup);
}
function backTH(){}
function arrowTH(dir){}
function keyHandler(keyTH,param2){
	if (keyTH == "focus"){
		focusTH();
	} else if (keyTH == "blur"){
		release();
	} else if (keyTH == "apply"){
		//webMI.gfx.setFill("button_stroke", "url(#linear_2)");
		applyTH();
	} else if (keyTH == "releaseClick"){
		//webMI.gfx.setFill("button_stroke", "url(#linear_1)");
	} else if (keyTH == "back"){
		backTH();
	} else if (keyTH == "arrow"){
		arrowTH(param2);
	} else if (keyTH == "isActive"){
		return active && param2(document.getElementById("button_clickarea").parentNode);
	}
}

webMI.addEvent("button_clickarea", ["click","mousedown","touchstart"], function(e) {
var id = "button_clickarea";
var value = true;
return function(value) {
		if (active) {
			webMI.gfx.setFill("button_stroke", "none"); // "url(#linear_2)"
//			webMI.gfx.setFill("button_bg", window.theme.getValue('ControlActiveBackgroundColor')); // added
			webMI.gfx.setStroke("button_stroke", webMI.query['focusStrokeColor']);
		}
} (value);
});

webMI.addEvent("button_clickarea", ["click","mouseup","touchend","touchcancel"], function(e) {
var id = "button_clickarea";
var value = true;
return function(value) {
		release();
} (value);
});

webMI.addEvent("button_clickarea", ["mouseout", "touchleave"], function(e) {
	var id = "button_clickarea";
	var value = true;
	return function(value) {
		release();
	} (value);
});

webMI.addEvent("button_clickarea", ('ontouchend' in window ? 'touchend' : 'click'), function(e) {
	if (active){
		tabHandler.setCurrentIndex(keyHandler, function(){
			webMI.trigger.fire("clicked", true, "")
		});
		//webMI.trigger.fire("clicked", true, "");
	}
	if (consistencyGroup)
		consistencyFunction == "write" ? consistencyHandler.write(consistencyGroup) : consistencyHandler.read(consistencyGroup);
});

webMI.addEvent("button_clickarea", ["touchend"], function(e) {
	var pX = event.pageX,
		pY = event.pageY;
	e.preventDefault();
});

webMI.addEvent("button_clickarea", ["touchleave"], function() {
	alert('leaving');
})

webMI.addEvent("button_clickarea", "dragstart", function(e) {
	if (e.preventDefault) {
		e.preventDefault();
	}
});
webMI.addOnload(function() {
	var doc = document.getElementById("button_clickarea").ownerDocument;
	tabHandler.register(tabIndex,keyHandler,doc);
});

webMI.trigger.connect("com.atvise.setActive", function(e){
	if (e.value){
		deActivate();
	}  else {
		deActivate(true);
	}
});

if (tooltip != ""){
	webMI.callExtension("SYSTEM.LIBRARY.ATVISE.QUICKDYNAMICS.Tooltip", {"auto":"true", "id":"button_clickarea", "text":tooltip});
}

/*webMI.trigger.connect('com.bachmann.themechange', function() {
	webMI.gfx.setStroke('button_stroke', (webMI.gfx.getStroke('button_stroke') == 'none') ? 'none' : webMI.query['focusStrokeColor']);
});*/

webMI.trigger.connect('com.bachmann.themeapplied', function(e) {
	webMI.gfx.setStroke('button_stroke', (webMI.gfx.getStroke('button_stroke') == 'none') ? 'none' : webMI.query['focusStrokeColor']);
}, '_button_stroke');

// Theme

//change here the colors for the GUI Theme
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"font family", "defaultValue":"Open Sans", "id":"button_label", "key":"FontFamily", "property":"fontFamily"});
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"fill", "defaultValue":"#ffffff", "id":"button_label", "key":"ControlTextColor", "property":"fontColor"});
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"fill", "defaultValue":"#3f434a", "id":"id_2", "key":"ControlBackgroundColor", "property":"fillColor"});
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"fill", "defaultValue":"#ffffff", "id":"button_symbol", "key":"ControlTextColor", "property":"symbolColor"});
webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"stroke", "defaultValue":"#E3D700", "id":"_button_stroke", "key":"ControlTintColor", "property":"focusStrokeColor"});

webMI.callExtension("SYSTEM.LIBRARY.PROJECT.QUICKDYNAMICS.Theme", {"action":"fill", "defaultValue":"#8c8c8c", "key":"ControlInactiveBackgroundColor", "property":"fillColorInactive"});
// hide stroke on init
webMI.gfx.setStroke('button_stroke', 'none');

// Two Hand support
webMI.trigger.connect('com.bachmann.themechange', function(e) {
	//deActivate(!active);
})
},{"button_symbol":["3",{"symbolColor":{b:"symbolColor"}}]},{"consistencyFunction":"write","fillColor":"#647a8f","fillColorInactive":"#647a8f","focusStrokeColor":"#647a8f","fontColor":"#FFFFFF","fontFamily":"Open Sans","fontSize":"16","label":"Basic","strokePressed":"#647a8f","symbol":"00000010","symbolColor":"#FFFFFF","visibilityLabel":"inherit","visibilitySymbol":"hidden"}],"3":[function(webMI,window,document,self){},{},{"symbolColor":"#000000"}]},window);
//]]></script>
 </body>
</html>
